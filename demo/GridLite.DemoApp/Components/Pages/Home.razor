@page "/"

<IgbGridLite @ref=grid TItem="NwindDataItem" Data="NwindData" class="grid" home-scope
          SortingOptions="@sortingOptions"
          SortingExpressions="@initialSort"
          FilterExpressions="@initialFilter"
          Sorting="HandleSorting" Sorted="HandleSorted"
          Filtering="HandleFiltering" Filtered="HandleFiltered">
    @foreach (var col in cols)
    {
        <IgbGridLiteColumn
            Field="@col.Field"
            Header="@col.Header"
            DataType="@col.DataType"
            Sortable="@col.Sortable"
            SortingCaseSensitive="@col.SortingCaseSensitive"
            Filterable="@col.Filterable"
            Resizable="@col.Resizable" />
    }
    @if (showUnitColumns)
    {
        <IgbGridLiteColumn
            Field="@nameof(NwindDataItem.UnitsOnOrder)"
            Header="Units On Order"
            DataType="GridLiteColumnDataType.Number"
            Sortable Filterable Resizable />
    }
</IgbGridLite>

<button @onclick="BtnClick">Sort</button>
<button @onclick="ToggleUnitColumns">Toggle Unit columns</button>

@code {
    public IgbGridLite<NwindDataItem> grid;

    private IgbGridLiteSortingOptions sortingOptions = new IgbGridLiteSortingOptions()
    {
        Mode = GridLiteSortingMode.Multiple
    };

    private List<IgbGridLiteSortingExpression> initialSort;
    private List<IgbGridLiteFilterExpression> initialFilter;
    private bool showUnitColumns = false;

    protected override void OnInitialized()
    {
        initialFilter = new List<IgbGridLiteFilterExpression>
        {
            new IgbGridLiteFilterExpression
            {
                Key = nameof(NwindDataItem.ProductName),
                Condition = "contains",
                SearchTerm = "a"
            },
            new IgbGridLiteFilterExpression
            {
                Key = nameof(NwindDataItem.ProductName),
                Condition = "contains",
                SearchTerm = "b"
            }
        };

        initialSort = new List<IgbGridLiteSortingExpression>
        {
            new IgbGridLiteSortingExpression
            {
                Key = nameof(NwindDataItem.ProductName),
                Direction = GridLiteSortingDirection.Ascending
            }
        };
    }

    public async Task BtnClick()
    {
        await this.grid.SortAsync(new List<IgbGridLiteSortingExpression>
            {
                new IgbGridLiteSortingExpression() { Key = nameof(NwindDataItem.ProductName), Direction = GridLiteSortingDirection.Descending }
            }
        );
    }

    public async Task ToggleUnitColumns()
    {
        showUnitColumns = !showUnitColumns;
        if (showUnitColumns)
        {
            cols = [
                .. cols,
                new IgbColumnConfiguration {
                    Field = nameof(NwindDataItem.QuantityPerUnit),
                    Header="Quantity Per Unit",
                    DataType = GridLiteColumnDataType.String,
                    Sortable = true,
                    Filterable = true,
                    Resizable = true
                },
                new IgbColumnConfiguration {
                    Field = nameof(NwindDataItem.UnitPrice),
                    Header="Unit Price",
                    DataType = GridLiteColumnDataType.Number,
                    Sortable = true,
                    Filterable = true,
                    Resizable = true
                }
            ];
            initialSort = [
                .. initialSort,
                new IgbGridLiteSortingExpression
                {
                    Key = nameof(NwindDataItem.QuantityPerUnit),
                    Direction = GridLiteSortingDirection.Ascending
                }
            ];
        }
        else
        {
            cols = cols.SkipLast(2).ToList();
            initialSort = initialSort.SkipLast(1).ToList();
        }
    }

    private NwindData _nwindData = null;
    public NwindData NwindData
    {
        get
        {
            if (_nwindData == null)
            {
                _nwindData = new NwindData();
            }
            return _nwindData;
        }
    }

    private void HandleSorting(IgbGridLiteSortingEventArgs e)
    {

    }

    private void HandleSorted(IgbGridLiteSortedEventArgs e)
    {

    }

    private void HandleFiltering(IgbGridLiteFilteringEventArgs e)
    {

    }

    private void HandleFiltered(IgbGridLiteFilteredEventArgs e)
    {

    }

    public List<IgbColumnConfiguration> cols = new List<IgbColumnConfiguration> {
        new IgbColumnConfiguration {
            Field = nameof(NwindDataItem.ProductID),
            Header="Product ID",
            DataType = GridLiteColumnDataType.Number,
            Sortable = true,
            SortingCaseSensitive = false,
            Filterable = true,
            Resizable = false
        },
        new IgbColumnConfiguration {
            Field = nameof(NwindDataItem.ProductName),
            Header="Product Name",
            DataType = GridLiteColumnDataType.String,
            Sortable = true,
            Filterable = true,
            Resizable = true
        },
    };
}
